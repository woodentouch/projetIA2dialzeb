<!-- Header -->
<section class="events-header">
  <div class="container">
    <div class="header-content">
      <div class="header-text">
        <h1 class="page-title">Événements</h1>
        <p class="page-subtitle">Découvrez les meilleurs événements près de chez vous</p>
      </div>

      <div class="header-actions">
        <button (click)="toggleFilters()" class="btn-filter-toggle" [class.active]="showFilters">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
          </svg>
          Filtres
        </button>

        <button (click)="toggleViewMode()" class="btn-view-toggle">
          <svg *ngIf="viewMode === 'grid'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          <svg *ngIf="viewMode === 'list'" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input
            type="text"
            [(ngModel)]="filters.search"
            (keyup.enter)="applyFilters()"
            placeholder="Rechercher un événement, artiste, lieu..."
            class="search-input">
          <button (click)="applyFilters()" class="search-btn">
            Rechercher
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Advanced Filters -->
<section class="filters-section" [class.show]="showFilters">
  <div class="container">
    <div class="filters-container">
      <div class="filters-grid">
        <!-- Category Filter -->
        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            Catégorie
          </label>
          <select [(ngModel)]="filters.categoryId" (change)="applyFilters()" class="filter-select">
            <option [value]="undefined">Toutes les catégories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>

        <!-- City Filter -->
        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            Ville
          </label>
          <select [(ngModel)]="filters.city" (change)="applyFilters()" class="filter-select">
            <option value="">Toutes les villes</option>
            <option *ngFor="let city of uniqueCities" [value]="city">
              {{ city }}
            </option>
          </select>
        </div>

        <!-- Date Filter -->
        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            À partir du
          </label>
          <input
            type="date"
            [(ngModel)]="filters.startDate"
            (change)="applyFilters()"
            class="filter-input">
        </div>

        <!-- Price Filters -->
        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            Prix minimum (€)
          </label>
          <input
            type="number"
            [(ngModel)]="filters.minPrice"
            (change)="applyFilters()"
            placeholder="0"
            min="0"
            class="filter-input">
        </div>

        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            Prix maximum (€)
          </label>
          <input
            type="number"
            [(ngModel)]="filters.maxPrice"
            (change)="applyFilters()"
            placeholder="500"
            min="0"
            class="filter-input">
        </div>

        <!-- Sort -->
        <div class="filter-group">
          <label class="filter-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M7 16V4m0 0L3 8m4-4 4 4m6 0v12m0 0 4-4m-4 4-4-4"/>
            </svg>
            Trier par
          </label>
          <select [(ngModel)]="filters.sortBy" (change)="applyFilters()" class="filter-select">
            <option value="date">Date</option>
            <option value="price">Prix</option>
            <option value="popularity">Popularité</option>
          </select>
        </div>
      </div>

      <div class="filters-actions">
        <button (click)="clearFilters()" class="btn-clear">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"/>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
          </svg>
          Effacer les filtres
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Results Section -->
<section class="results-section">
  <div class="container">
    <!-- Results Header -->
    <div class="results-header">
      <div class="results-count">
        <span class="count-number">{{ totalElements }}</span>
        <span class="count-text">événement{{ totalElements > 1 ? 's' : '' }} trouvé{{ totalElements > 1 ? 's' : '' }}</span>
      </div>

      <div class="results-sort">
        <select [(ngModel)]="filters.sortOrder" (change)="applyFilters()" class="sort-select">
          <option value="asc">Croissant</option>
          <option value="desc">Décroissant</option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-grid">
        <div class="loading-card" *ngFor="let i of [1,2,3,4,5,6]">
          <div class="loading-image"></div>
          <div class="loading-content">
            <div class="loading-title"></div>
            <div class="loading-meta"></div>
            <div class="loading-price"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Luxury Events Grid -->
    <section *ngIf="!loading" class="luxury-events">
      <div class="events-grid">
        <article class="event-card"
                 *ngFor="let event of filteredEvents; let i = index; trackBy: trackByEventId"
                 [class.event-card-large]="i % 6 === 0"
                 [class.event-card-medium]="i % 6 === 1 || i % 6 === 2"
                 [class.event-card-small]="i % 6 >= 3">

          <div class="event-image-container" [routerLink]="['/events', event.id]">
            <img class="event-image"
                 [src]="getEventImage(event)"
                 [alt]="event.title" 
                 loading="lazy"
                 (error)="onImageError($event, event.category?.name)">
            <div class="event-overlay"></div>
          </div>

          <!-- Favorite Button -->
          <button *ngIf="currentUser" 
                  class="btn-favorite" 
                  [class.active]="event.isFavorite"
                  (click)="onFavoriteToggle(event); $event.stopPropagation()"
                  [title]="event.isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" [attr.fill]="event.isFavorite ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </button>

          <div class="event-content" [routerLink]="['/events', event.id]">
            <div class="event-category">{{ event.category?.name || 'Événement' }}</div>
            <h3 class="event-title">{{ event.title }}</h3>
            <div class="event-meta">
              <span class="event-meta-item" *ngIf="event.date">
                <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                {{ formatDate(event.date) }}
              </span>
              <span class="event-meta-item" *ngIf="event.location?.city as city">
                <svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                {{ city }}
              </span>
            </div>
            <p class="event-description">{{ event.description }}</p>
            <div class="event-action">Voir plus
              <svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- No Results -->
    <div *ngIf="!loading && filteredEvents.length === 0" class="no-results">
      <div class="no-results-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
      </div>
      <h3 class="no-results-title">Aucun événement trouvé</h3>
      <p class="no-results-text">
        Essayez de modifier vos critères de recherche ou d'élargir votre zone géographique.
      </p>
      <button (click)="clearFilters()" class="btn-reset">
        Réinitialiser les filtres
      </button>
    </div>

    <!-- Load More (if needed) -->
    <div class="load-more" *ngIf="currentPage < totalPages - 1 && !loading">
      <button class="btn-load-more" (click)="loadMore()">
        Charger plus d'événements
      </button>
    </div>
  </div>
</section>
