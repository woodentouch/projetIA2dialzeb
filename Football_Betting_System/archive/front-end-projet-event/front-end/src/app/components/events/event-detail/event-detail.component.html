<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Chargement de l'événement...</p>
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error-container">
  <div class="error-icon">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" y1="8" x2="12" y2="12"/>
      <line x1="12" y1="16" x2="12.01" y2="16"/>
    </svg>
  </div>
  <h2>Événement introuvable</h2>
  <p>Désolé, nous n'avons pas pu trouver cet événement.</p>
  <button (click)="goToEvents()" class="btn btn-primary">
    Retour aux événements
  </button>
</div>

<!-- Event Content -->
<div *ngIf="event && !loading" class="event-detail">
  <!-- Hero Section -->
  <section class="event-hero">
    <div class="hero-image">
      <img [src]="event.imageUrl || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=1200'" 
           [alt]="event.title">
      <div class="hero-overlay"></div>
    </div>
    
    <div class="hero-content container">
      <button (click)="goToEvents()" class="btn-back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Retour
      </button>

      <div class="hero-info">
        <span class="event-category">{{ event.category?.name }}</span>
        <h1 class="event-title">{{ event.title }}</h1>
        
        <div class="event-meta">
          <div class="meta-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            {{ formatDate(event.date || '') }}
          </div>
          
          <div class="meta-item" *ngIf="event.time">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
            {{ event.time }}
          </div>
          
          <div class="meta-item" *ngIf="event.location">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            {{ event.location.name }}, {{ event.location.city }}
          </div>
          
          <div class="meta-item" *ngIf="event.viewCount">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            {{ event.viewCount }} vues
          </div>
        </div>

        <div class="hero-actions">
          <button 
            *ngIf="event.link" 
            (click)="buyTicket()" 
            class="btn btn-primary btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h18v18H3zM21 9l-9 6-9-6"/>
            </svg>
            Acheter des billets
          </button>
          
          <div 
            *ngIf="!event.link" 
            class="btn btn-primary btn-large btn-disabled">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
            {{ formatPrice(event.price || 0) }}
          </div>
          
          <button (click)="shareEvent()" class="btn btn-outline">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="18" cy="5" r="3"/>
              <circle cx="6" cy="12" r="3"/>
              <circle cx="18" cy="19" r="3"/>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
            </svg>
            Partager
          </button>

          <!-- Admin Actions -->
          <button *ngIf="isAdmin()" (click)="editEvent()" class="btn btn-outline btn-admin">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Modifier
          </button>
          
          <button *ngIf="isAdmin()" (click)="confirmDelete()" class="btn btn-outline btn-danger-outline">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
            </svg>
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Details Section -->
  <section class="event-details section-padding">
    <div class="container">
      <div class="details-grid">
        <!-- Main Content -->
        <div class="details-main">
          <div class="detail-card">
            <h2 class="section-title">À propos de l'événement</h2>
            <p class="event-description">{{ event.description }}</p>
          </div>

          <!-- Location Details -->
          <div class="detail-card" *ngIf="event.location">
            <h2 class="section-title">Lieu</h2>
            <div class="location-info">
              <div class="location-header">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
                <div>
                  <h3>{{ event.location.name }}</h3>
                  <p>{{ event.location.address }}</p>
                  <p>{{ event.location.city }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="details-sidebar">
          <!-- Event Info Card -->
          <div class="info-card">
            <h3 class="card-title">Informations</h3>
            
            <div class="info-list">
              <div class="info-item">
                <span class="info-label">Prix</span>
                <span class="info-value">{{ formatPrice(event.price || 0) }}</span>
              </div>
              
              <div class="info-item">
                <span class="info-label">Date</span>
                <span class="info-value">{{ formatDate(event.date || '') }}</span>
              </div>
              
              <div class="info-item" *ngIf="event.time">
                <span class="info-label">Heure</span>
                <span class="info-value">{{ event.time }}</span>
              </div>
              
              <div class="info-item">
                <span class="info-label">Catégorie</span>
                <span class="info-value">{{ event.category?.name }}</span>
              </div>
              
              <div class="info-item" *ngIf="event.location">
                <span class="info-label">Ville</span>
                <span class="info-value">{{ event.location.city }}</span>
              </div>
            </div>
            
            <button 
              *ngIf="event.link" 
              (click)="buyTicket()" 
              class="btn btn-primary btn-block">
              Acheter des billets
            </button>
            
            <div 
              *ngIf="!event.link" 
              class="btn btn-primary btn-block btn-disabled">
              Prix: {{ formatPrice(event.price || 0) }}
            </div>
          </div>

          <!-- Share Card -->
          <div class="info-card">
            <h3 class="card-title">Partager</h3>
            <button (click)="shareEvent()" class="btn btn-outline btn-block">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
              Partager cet événement
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Recommended Events -->
  <section class="recommended-section section-padding" *ngIf="recommendedEvents.length > 0">
    <div class="container">
      <h2 class="section-title">Événements similaires</h2>
      
      <div class="recommended-grid">
        <article class="event-card" *ngFor="let recEvent of recommendedEvents" [routerLink]="['/events', recEvent.id]">
          <div class="event-image">
            <img [src]="recEvent.imageUrl || 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400'" 
                 [alt]="recEvent.title">
          </div>
          <div class="event-content">
            <span class="event-category">{{ recEvent.category?.name }}</span>
            <h3 class="event-title">{{ recEvent.title }}</h3>
            <div class="event-meta">
              <span>{{ formatDate(recEvent.date || '') }}</span>
              <span *ngIf="recEvent.location">{{ recEvent.location.city }}</span>
            </div>
            <div class="event-price">{{ formatPrice(recEvent.price || 0) }}</div>
          </div>
        </article>
      </div>
    </div>
  </section>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Confirmer la suppression</h2>
      <button class="modal-close" (click)="cancelDelete()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <p>Êtes-vous sûr de vouloir supprimer cet événement ?</p>
      <p class="warning-text">Cette action est irréversible.</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelDelete()">Annuler</button>
      <button class="btn btn-danger" (click)="deleteEvent()">Supprimer</button>
    </div>
  </div>
</div>
